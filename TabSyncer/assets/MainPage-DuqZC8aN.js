import{d as se,k as ie,h as Z,f as k,c as V,o as g,I as z,m as F,G as o,b as r,u as t,a as v,t as s,H as w,_ as re,r as P,w as _e,J as be,K as ne,L as De,z as N,F as j,e as Q,q as ye,M as Ue,N as Ae,O as ue,P as te,Q as Ne,R as Re,S as Oe,T as Le}from"./index-DRROFMK1.js";import{h as R}from"../main.js";function Fe(h){return R.get("/tab/api/v1/snapshot/list",{params:h?{groupId:h}:{}}).then(f=>{var e;return(e=f.data.data)==null?void 0:e.list})}function Ze(h,f){return R.post("/tab/api/v1/snapshot/rename",{id:h,name:f}).then(e=>e.data.data)}function ve(h){return R.post("/tab/api/v1/snapshot/delete",{ids:h}).then(f=>f.data.data)}function He(h,f){return R.post("/tab/api/v1/snapshot/group",{id:h,groupId:f}).then(e=>e.data)}function We(h,f){return R.post("/tab/api/v1/snapshot/remove-tab",{snapshotId:h,tabId:f}).then(e=>e.data)}function Ye(h,f,e,d){return R.post("/tab/api/v1/snapshot/merge",{ids:h,keepOld:f,name:e,groupId:d}).then(x=>{var p;return(p=x.data.data)==null?void 0:p.snapshot})}function je(){return R.get("/tab/api/v1/snapshot/trash").then(h=>{var f;return(f=h.data.data)==null?void 0:f.list})}function ge(h){return R.post("/tab/api/v1/snapshot/restore",{ids:h}).then(f=>f.data.data)}function qe(h){return R.post("/tab/api/v1/snapshot/add-tab",h).then(f=>f.data.data)}const Je={class:"detail-root"},Ke=["src"],Qe={key:1,style:{width:"20px",height:"20px","border-radius":"4px",background:"#eee"}},Xe=["title"],et=["href"],tt=se({__name:"SnapshotDetail",props:{snapshot:{},currentPage:{},pageSize:{}},emits:["remove-tab","prev-page","next-page","update:currentPage"],setup(h,{emit:f}){const e=h,d=f,x=ie("i18n",{}),p=x.snapshot||{},$=x.list||{},b=x.detail||{icon:p.icon||"图标",title:p.title||"标题",url:p.url||"网址",action:p.action||"操作",delete:p.delete||"删除",noTabs:$.noTabs||"该快照没有标签页",deleteFail:$.deleteFail||"删除失败"},y=e.pageSize||15,c=Z(()=>{const m=(e.currentPage-1)*y;return(e.snapshot.tabs||[]).slice(m,m+y)}),E=Z(()=>{var m;return Math.max(1,Math.ceil((((m=e.snapshot.tabs)==null?void 0:m.length)||0)/y))});function D(m){d("update:currentPage",m)}function _(m){!e.snapshot.id||!m.id||We(e.snapshot.id,m.id).then(C=>{C.code===1?d("remove-tab",m):alert(C.message||b.deleteFail)})}return(m,C)=>{var U;const O=k("el-table-column"),G=k("el-button"),l=k("el-table"),u=k("el-empty"),M=k("el-pagination");return g(),V("div",Je,[c.value.length>0?(g(),z(l,{key:0,data:c.value,border:"",size:"small",style:{width:"100%","margin-bottom":"12px"},"show-header":!0},{default:o(()=>[r(O,{label:t(b).icon,width:"48"},{default:o(T=>[T.row.favIconUrl?(g(),V("img",{key:0,src:T.row.favIconUrl,style:{width:"20px",height:"20px","border-radius":"4px"}},null,8,Ke)):(g(),V("div",Qe))]),_:1},8,["label"]),r(O,{prop:"title",label:t(b).title,"min-width":"120"},{default:o(T=>[v("span",{title:T.row.title,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",display:"block","max-width":"200px"}},s(T.row.title),9,Xe)]),_:1},8,["label"]),r(O,{prop:"url",label:t(b).url,"min-width":"200"},{default:o(T=>[v("a",{href:T.row.url,target:"_blank",style:{color:"#409EFF","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",display:"block","max-width":"320px"}},s(T.row.url),9,et)]),_:1},8,["label"]),r(O,{label:t(b).action,width:"70"},{default:o(T=>[r(G,{size:"small",type:"danger",onClick:L=>_(T.row)},{default:o(()=>[w(s(t(b).delete),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])):(g(),z(u,{key:1,description:t(b).noTabs},null,8,["description"])),E.value>1?(g(),z(M,{key:2,"current-page":m.currentPage,"page-size":t(y),total:((U=m.snapshot.tabs)==null?void 0:U.length)||0,layout:"prev, pager, next",small:"",background:"",style:{"margin-top":"8px","text-align":"right"},onCurrentChange:D},null,8,["current-page","page-size","total"])):F("",!0)])}}}),nt=re(tt,[["__scopeId","data-v-09be8233"]]),at={class:"snapshot-item-header"},ot={class:"snapshot-item-info"},lt=["title"],st={class:"snapshot-item-meta"},it={class:"snapshot-item-actions"},rt={key:0,class:"snapshot-detail-wrapper"},ut=se({__name:"SnapshotItem",props:{snapshot:{},isExpanded:{type:Boolean},currentPage:{},groupOptions:{},manageMode:{type:Boolean},selected:{type:Boolean},hideMore:{type:Boolean},inTrash:{type:Boolean}},emits:["open","rename","delete","toggle-expand","remove-tab","prev-page","next-page","update:currentPage","refresh","select","item-click","restore","add-tab"],setup(h,{emit:f}){const e=ie("i18n",{}),d=e.snapshot||{},x=e.list||{},p=h,$=f,b=Z(()=>p.groupOptions),y=P(p.snapshot.groupId),c=P(!1),E=Z(()=>{var u,M;const l=b.value.find(U=>U.id===p.snapshot.groupId||p.snapshot.groupId==null&&U.id==null);return l?l.id==null?b.value.findIndex(T=>T.id==null)===0?((u=e.sidebar)==null?void 0:u.all)||"全部":((M=e.sidebar)==null?void 0:M.ungrouped)||"未分组":l.name:d.unnamed});_e(()=>p.snapshot.groupId,l=>{y.value=l});function D(l){const u=l==null||l===""?null:Number(l);He(p.snapshot.id,u).then(()=>{y.value=u,c.value=!1,p.snapshot.groupId=u})}function _(l){const u=new Date(l),M=U=>U.toString().padStart(2,"0");return`${u.getFullYear()}-${M(u.getMonth()+1)}-${M(u.getDate())} ${M(u.getHours())}:${M(u.getMinutes())}`}function m(l){$("update:currentPage",l)}be(()=>{console.log("[SnapshotItem] 快照ID:",p.snapshot.id,"groupId:",p.snapshot.groupId,"currentGroupName:",E.value),console.log("[SnapshotItem] 分组下拉内容:",b.value),console.log("[SnapshotItem] 选中状态:",p.selected,"isExpanded:",p.isExpanded,"manageMode:",p.manageMode)});const C=Z(()=>p.manageMode),O=Z(()=>p.selected),G=Z(()=>p.inTrash);return(l,u)=>{const M=k("el-tag"),U=k("el-option"),T=k("el-select"),L=k("el-popover"),B=k("el-button"),X=k("el-dropdown-item"),ae=k("el-dropdown-menu"),de=k("el-dropdown"),ee=k("el-collapse-transition"),pe=k("el-card");return g(),z(pe,{class:ne(["snapshot-item-card",{selected:O.value}]),shadow:"hover",onClick:u[13]||(u[13]=I=>C.value?l.$emit("item-click"):void 0)},{default:o(()=>[v("div",at,[v("div",ot,[De(l.$slots,"checkbox",{},void 0,!0),r(M,{size:"small",type:"info",effect:"plain"},{default:o(()=>[w(s(_(l.snapshot.createdAt)),1)]),_:1}),v("span",{class:ne(["snapshot-item-title",{disabled:C.value||G.value}]),title:l.snapshot.name||t(d).unnamed,onClick:u[0]||(u[0]=N(I=>!C.value&&!G.value&&l.$emit("rename",l.snapshot),["stop"]))},s(l.snapshot.name||t(d).unnamed),11,lt),!C.value&&!G.value?(g(),z(L,{key:0,placement:"bottom",width:"140",trigger:"click",visible:c.value,"onUpdate:visible":u[2]||(u[2]=I=>c.value=I)},{reference:o(()=>[r(M,{size:"small",type:"primary",class:"group-tag",style:{cursor:"pointer","margin-left":"8px"}},{default:o(()=>[w(s(E.value),1)]),_:1})]),default:o(()=>[r(T,{modelValue:y.value,"onUpdate:modelValue":u[1]||(u[1]=I=>y.value=I),placeholder:t(d).group,size:"small",class:"group-select",onChange:D,style:{width:"120px"}},{default:o(()=>[(g(!0),V(j,null,Q(b.value,I=>(g(),z(U,{key:I.id,label:I.name,value:I.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["visible"])):(g(),z(M,{key:1,size:"small",type:"primary",class:"group-tag",style:{"margin-left":"8px"}},{default:o(()=>[w(s(E.value),1)]),_:1}))]),v("div",st,[r(M,{size:"small",type:"success",class:"snapshot-item-count clickable",onClick:u[3]||(u[3]=I=>l.$emit("toggle-expand",l.snapshot.id))},{default:o(()=>{var I;return[w(s(t(d).tabCount(((I=l.snapshot.tabs)==null?void 0:I.length)||0)),1)]}),_:1})]),v("div",it,[C.value?F("",!0):(g(),z(B,{key:0,size:"small",type:"success",onClick:u[4]||(u[4]=I=>l.$emit("open",l.snapshot))},{default:o(()=>[w(s(t(d).open),1)]),_:1})),r(B,{size:"small",type:"primary",onClick:u[5]||(u[5]=N(I=>l.$emit("toggle-expand",l.snapshot.id),["stop"]))},{default:o(()=>[w(s(l.isExpanded?t(d).collapse:t(d).expand),1)]),_:1}),C.value?F("",!0):(g(),z(de,{key:1,trigger:"click","hide-on-click":!1},{dropdown:o(()=>[r(ae,null,{default:o(()=>[p.inTrash?F("",!0):(g(),z(X,{key:0,onClick:u[6]||(u[6]=N(I=>l.$emit("rename",l.snapshot),["stop"]))},{default:o(()=>[w(s(t(d).rename),1)]),_:1})),p.inTrash?F("",!0):(g(),z(X,{key:1,onClick:u[7]||(u[7]=N(I=>l.$emit("add-tab",l.snapshot),["stop"]))},{default:o(()=>[w(s(t(x).addTab||"添加"),1)]),_:1})),p.inTrash?F("",!0):(g(),z(X,{key:2,onClick:u[8]||(u[8]=N(I=>l.$emit("delete",l.snapshot.id),["stop"]))},{default:o(()=>[w(s(t(d).delete),1)]),_:1})),p.inTrash?(g(),z(X,{key:3,onClick:u[9]||(u[9]=N(I=>l.$emit("restore",l.snapshot.id),["stop"]))},{default:o(()=>[w(s(t(x).restore),1)]),_:1})):F("",!0)]),_:1})]),default:o(()=>[r(B,{size:"small",type:"default",class:"more-btn"},{default:o(()=>[w(s(t(d).more),1)]),_:1})]),_:1}))])]),r(ee,null,{default:o(()=>[l.isExpanded?(g(),V("div",rt,[r(nt,{snapshot:l.snapshot,"current-page":l.currentPage,onRemoveTab:u[10]||(u[10]=I=>l.$emit("remove-tab",l.snapshot,I)),onPrevPage:u[11]||(u[11]=I=>l.$emit("prev-page",l.snapshot.id)),onNextPage:u[12]||(u[12]=I=>l.$emit("next-page",l.snapshot.id,l.snapshot)),"onUpdate:currentPage":m},null,8,["snapshot","current-page"])])):F("",!0)]),_:1})]),_:3},8,["class"])}}}),dt=re(ut,[["__scopeId","data-v-682082ae"]]),pt={class:"snapshot-container"},ct={class:"snapshot-header-row"},mt={class:"snapshot-header-actions"},vt={key:0,class:"snapshot-selected-bar"},gt={class:"selected-count"},ft={class:"selected-list"},ht=["onClick"],_t=["checked","onChange"],bt={key:3,class:"snapshot-manage-footer"},yt={key:4,class:"snapshot-manage-footer"},kt={class:"dialog-list dialog-list-scroll"},wt={class:"dialog-list-time"},$t={class:"dialog-list-name"},Tt={class:"dialog-list-count"},Ct={class:"dialog-list dialog-list-scroll"},It={class:"dialog-list-time"},xt={class:"dialog-list-name"},St={class:"dialog-list-count"},Pt={class:"dialog-list dialog-list-scroll"},Vt={class:"dialog-list-time"},Gt={class:"dialog-list-name"},Mt={class:"dialog-list-count"},zt=se({__name:"SnapshotList",props:{groupId:{},groupOptions:{}},setup(h){const f=ie("i18n",{}),e=f.list||{},d=f.snapshot||{},x=h,p=P([]),$=P([]),b=P({}),y=P(!1),c=P([]),E=P(!1),D=P(!1),_=P(!1),m=P(!1),C=P(""),O=P(null),G=P(!1),l=P(""),u=P(""),M=P(!1),U=P(null),T=P(""),L=Z(()=>Array.isArray(p.value)?p.value:[]);function B(){if(x.groupId==="__trash__")je().then(a=>{p.value=Array.isArray(a)?a:[],y.value&&(c.value=[])});else{const a=typeof x.groupId=="number"?x.groupId:void 0;Fe(a).then(n=>{p.value=Array.isArray(n)?n:[],y.value&&(c.value=[])})}}function X(){y.value=!y.value,c.value=[],$.value=[]}function ae(a){const n=c.value.indexOf(a);n===-1?c.value.push(a):c.value.splice(n,1)}function de(a){c.value=c.value.filter(n=>n!==a)}function ee(a){const n=new Date(a),S=W=>W.toString().padStart(2,"0");return`${n.getFullYear()}-${S(n.getMonth()+1)}-${S(n.getDate())} ${S(n.getHours())}:${S(n.getMinutes())}`}function pe(){ve(c.value).then(()=>{E.value=!1,B()})}function I(){c.value.length<2||Ye(c.value,m.value,C.value).then(()=>{D.value=!1,C.value="",B()})}function ke(){ge(c.value).then(()=>{_.value=!1,B()})}function we(a){y.value||te.prompt(e.renamePrompt,e.renameTitle,{confirmButtonText:e.confirm,cancelButtonText:e.cancel,inputValue:a.name||""}).then(({value:n})=>{n&&Ze(a.id,n).then(B)})}function $e(a){y.value||te.confirm(e.deleteConfirm,e.deleteTitle,{confirmButtonText:e.confirm,cancelButtonText:e.cancel,type:"warning"}).then(()=>{ve([a]).then(B)})}function Te(a){if(!a.tabs||!a.tabs.length){ue.warning(e.noTabs);return}chrome.runtime.sendMessage({action:"openTabs",tabs:a.tabs})}function Ce(a){$.value.includes(a)?$.value=$.value.filter(n=>n!==a):($.value.push(a),b.value[a]||(b.value[a]=1))}function ce(a){b.value[a]>1&&b.value[a]--}function Ie(a,n){var Y;const W=Math.max(1,Math.ceil((((Y=n.tabs)==null?void 0:Y.length)||0)/15));(b.value[a]||1)<W&&b.value[a]++}function xe(a,n){a.tabs=a.tabs.filter(oe=>oe.url!==n.url);const S=15,W=b.value[a.id]||1,Y=a.tabs.slice((W-1)*S,W*S).length;W>1&&Y===0&&ce(a.id),Se(a)}function Se(a){console.log("保存标签页变更:",a.id,a.tabs.length)}function Pe(a,n){b.value[a]=n}function Ve(a){const n=p.value.find(S=>S.id===a);return n?n.name&&n.name!==e.unnamed?n.name:ee(n.createdAt):a}function H(a){return p.value.find(n=>n.id===a)}function Ge(a){te.confirm(e.restoreConfirm||"确定恢复该快照？",e.restoreTitle||"恢复确认",{confirmButtonText:e.confirm,cancelButtonText:e.cancel,type:"warning"}).then(()=>{ge([a]).then(B)})}function Me(a){U.value=a.id,l.value="",u.value="",T.value="",G.value=!0}async function ze(){if(!/^https?:\/\/.+/.test(l.value.trim())){T.value=e.addTabUrlInvalid||"请输入有效的网址";return}M.value=!0,T.value="";try{await qe({snapshotId:U.value,url:l.value.trim(),name:u.value.trim()||void 0}),G.value=!1,B()}catch(a){T.value=(a==null?void 0:a.message)||e.addTabFail||"添加失败"}finally{M.value=!1}}return ye(()=>{B()}),_e(()=>x.groupId,B),be(()=>{console.log("[SnapshotList] groupOptions:",x.groupOptions),console.log("[SnapshotList] snapshots:",p.value.map(a=>({id:a.id,groupId:a.groupId,name:a.name})))}),(a,n)=>{const S=k("el-button"),W=k("el-empty"),Y=k("el-dialog"),oe=k("el-input"),Be=k("el-checkbox"),me=k("el-form-item"),Ee=k("el-form");return g(),V("div",pt,[v("div",ct,[v("h2",null,s(t(e).title),1),v("div",mt,[r(S,{type:"primary",onClick:B,plain:"",icon:t(Ue)},{default:o(()=>[w(s(t(e).refresh),1)]),_:1},8,["icon"]),r(S,{type:"warning",onClick:X,style:{"margin-left":"8px"}},{default:o(()=>[w(s(y.value?t(e).cancel:t(e).manage||"管理"),1)]),_:1})])]),y.value&&c.value.length?(g(),V("div",vt,[v("span",gt,s((t(e).selectedCount||"已选{count}项").replace("{count}",c.value.length)),1),v("div",ft,[(g(!0),V(j,null,Q(c.value,i=>(g(),V("span",{key:i,class:"selected-item"},[w(s(Ve(i))+" ",1),v("span",{class:"remove-btn",onClick:N(A=>de(i),["stop"])},"×",8,ht)]))),128))])])):F("",!0),L.value.length?(g(),V("div",{key:2,ref_key:"listWrapperRef",ref:O,class:"snapshot-list-wrapper"},[(g(!0),V(j,null,Q(p.value,i=>(g(),z(dt,{key:i.id,snapshot:i,"is-expanded":$.value.includes(i.id),"current-page":b.value[i.id]||1,"group-options":x.groupOptions,"manage-mode":y.value,selected:c.value.includes(i.id),"in-trash":x.groupId==="__trash__","onUpdate:currentPage":A=>Pe(i.id,A),onNextPage:Ie,onPrevPage:ce,onRemoveTab:xe,onToggleExpand:Ce,onDelete:$e,onRename:we,onOpen:Te,onRefresh:B,onSelect:A=>ae(i.id),onItemClick:A=>y.value&&ae(i.id),onRestore:Ge,onAddTab:Me},Ae({_:2},[y.value?{name:"checkbox",fn:o(()=>[v("input",{type:"checkbox",class:"item-checkbox",checked:c.value.includes(i.id),onChange:N(A=>ae(i.id),["stop"]),onClick:n[0]||(n[0]=N(()=>{},["stop"]))},null,40,_t)]),key:"0"}:void 0]),1032,["snapshot","is-expanded","current-page","group-options","manage-mode","selected","in-trash","onUpdate:currentPage","onSelect","onItemClick"]))),128))],512)):(g(),z(W,{key:1,description:t(e).empty},null,8,["description"])),y.value&&x.groupId==="__trash__"?(g(),V("div",bt,[r(S,{type:c.value.length?"primary":"info",disabled:!c.value.length,onClick:n[1]||(n[1]=i=>c.value.length?_.value=!0:t(ue).warning(t(e).selectTip||"请先选择快照"))},{default:o(()=>[w(s(t(e).restore||"恢复"),1)]),_:1},8,["type","disabled"])])):y.value?(g(),V("div",yt,[r(S,{type:c.value.length?"danger":"info",disabled:!c.value.length,onClick:n[2]||(n[2]=i=>c.value.length?E.value=!0:t(ue).warning(t(e).selectTip||"请先选择快照"))},{default:o(()=>[w(s(t(e).delete||"删除"),1)]),_:1},8,["type","disabled"]),r(S,{type:c.value.length>=2?"primary":"info",disabled:c.value.length<2,onClick:n[3]||(n[3]=i=>c.value.length>=2?D.value=!0:t(ue).warning(t(e).selectMultiTip||"请至少选择两个快照"))},{default:o(()=>[w(s(t(e).merge||"合并"),1)]),_:1},8,["type","disabled"])])):F("",!0),r(Y,{modelValue:E.value,"onUpdate:modelValue":n[5]||(n[5]=i=>E.value=i),title:t(e).deleteTitle||"确认删除",width:"400px"},{footer:o(()=>[r(S,{onClick:n[4]||(n[4]=i=>E.value=!1)},{default:o(()=>[w(s(t(e).cancel||"取消"),1)]),_:1}),r(S,{type:"danger",onClick:pe},{default:o(()=>[w(s(t(e).confirm||"确认"),1)]),_:1})]),default:o(()=>[v("div",null,s(t(e).deleteConfirm||"确定删除以下")+" "+s(c.value.length)+" "+s(t(e).snapshots||"个快照")+"?",1),v("ul",kt,[(g(!0),V(j,null,Q(c.value,i=>{var A,q,J,K;return g(),V("li",{key:i},[v("span",wt,s(ee((A=H(i))==null?void 0:A.createdAt)),1),v("span",$t,s(((q=H(i))==null?void 0:q.name)||t(e).unnamed),1),v("span",Tt,s((t(d).tabCount||t(e).tabCount||(le=>le+"个标签页"))(((K=(J=H(i))==null?void 0:J.tabs)==null?void 0:K.length)||0)),1)])}),128))])]),_:1},8,["modelValue","title"]),r(Y,{modelValue:D.value,"onUpdate:modelValue":n[9]||(n[9]=i=>D.value=i),title:t(e).mergeTitle||"合并快照",width:"400px"},{footer:o(()=>[r(S,{onClick:n[8]||(n[8]=i=>D.value=!1)},{default:o(()=>[w(s(t(e).cancel||"取消"),1)]),_:1}),r(S,{type:"primary",onClick:I,disabled:c.value.length<2},{default:o(()=>[w(s(t(e).merge||"合并"),1)]),_:1},8,["disabled"])]),default:o(()=>[v("div",null,s(t(e).mergeConfirm||"合并以下")+" "+s(c.value.length)+" "+s(t(e).snapshots||"个快照")+":",1),v("ul",Ct,[(g(!0),V(j,null,Q(c.value,i=>{var A,q,J,K;return g(),V("li",{key:i},[v("span",It,s(ee((A=H(i))==null?void 0:A.createdAt)),1),v("span",xt,s(((q=H(i))==null?void 0:q.name)||t(e).unnamed),1),v("span",St,s((t(d).tabCount||t(e).tabCount||(le=>le+"个标签页"))(((K=(J=H(i))==null?void 0:J.tabs)==null?void 0:K.length)||0)),1)])}),128))]),r(oe,{modelValue:C.value,"onUpdate:modelValue":n[6]||(n[6]=i=>C.value=i),placeholder:t(e).mergeNamePlaceholder||"请输入合并后快照名称",style:{margin:"12px 0"}},null,8,["modelValue","placeholder"]),r(Be,{modelValue:m.value,"onUpdate:modelValue":n[7]||(n[7]=i=>m.value=i)},{default:o(()=>[w(s(t(e).keepOld||"保留旧快照"),1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),r(Y,{modelValue:_.value,"onUpdate:modelValue":n[11]||(n[11]=i=>_.value=i),title:t(e).restoreTitle||"恢复确认",width:"400px"},{footer:o(()=>[r(S,{onClick:n[10]||(n[10]=i=>_.value=!1)},{default:o(()=>[w(s(t(e).cancel||"取消"),1)]),_:1}),r(S,{type:"primary",onClick:ke},{default:o(()=>[w(s(t(e).confirm||"确认"),1)]),_:1})]),default:o(()=>[v("div",null,s(t(e).restoreConfirm||"确定恢复以下")+" "+s(c.value.length)+" "+s(t(e).snapshots||"个快照")+"?",1),v("ul",Pt,[(g(!0),V(j,null,Q(c.value,i=>{var A,q,J,K;return g(),V("li",{key:i},[v("span",Vt,s(ee((A=H(i))==null?void 0:A.createdAt)),1),v("span",Gt,s(((q=H(i))==null?void 0:q.name)||t(e).unnamed),1),v("span",Mt,s((t(d).tabCount||t(e).tabCount||(le=>le+"个标签页"))(((K=(J=H(i))==null?void 0:J.tabs)==null?void 0:K.length)||0)),1)])}),128))])]),_:1},8,["modelValue","title"]),r(Y,{modelValue:G.value,"onUpdate:modelValue":n[16]||(n[16]=i=>G.value=i),title:t(e).addTabTitle||"添加标签页",width:"400px"},{footer:o(()=>[r(S,{onClick:n[15]||(n[15]=i=>G.value=!1)},{default:o(()=>[w(s(t(e).cancel||"取消"),1)]),_:1}),r(S,{type:"primary",loading:M.value,onClick:ze},{default:o(()=>[w(s(t(e).confirm||"确定"),1)]),_:1},8,["loading"])]),default:o(()=>[r(Ee,{onSubmit:n[14]||(n[14]=N(()=>{},["prevent"]))},{default:o(()=>[r(me,{label:t(e).addTabPrompt||"网址",error:T.value},{default:o(()=>[r(oe,{modelValue:l.value,"onUpdate:modelValue":n[12]||(n[12]=i=>l.value=i),maxlength:"200",placeholder:t(e).addTabPrompt||"请输入网址"},null,8,["modelValue","placeholder"])]),_:1},8,["label","error"]),r(me,{label:t(e).addTabNamePlaceholder||"标签名称（可选）"},{default:o(()=>[r(oe,{modelValue:u.value,"onUpdate:modelValue":n[13]||(n[13]=i=>u.value=i),placeholder:t(e).addTabNamePlaceholder||"标签名称（可选）"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])])}}}),fe=re(zt,[["__scopeId","data-v-ab2f43e0"]]);function Bt(){return R.get("/tab/api/v1/group/list").then(h=>{var f;return(f=h.data.data)==null?void 0:f.list})}function Et(h){return R.post("/tab/api/v1/group/create",{name:h}).then(f=>{var e;return(e=f.data.data)==null?void 0:e.group})}function Dt(h,f){return R.post("/tab/api/v1/group/rename",{id:h,name:f}).then(e=>{var d;return(d=e.data.data)==null?void 0:d.group})}function Ut(h){return R.post("/tab/api/v1/group/delete",{id:h}).then(f=>f.data)}const At={class:"sidebar-header"},Nt={class:"sidebar-title"},Rt={class:"menu-item-content"},Ot={class:"group-name"},Lt=se({__name:"GroupSidebar",props:{groups:{},horizontal:{type:Boolean}},emits:["update:modelValue","group-change","refresh"],setup(h,{emit:f}){const d=ie("i18n",{}).sidebar||{},x=h,p=Z(()=>{const _=[...x.groups];return _.find(m=>m.id==="__trash__")||_.push({id:"__trash__",name:d.trash}),_}),$=P(0),b=f;function y(_){var m,C;$.value=Number(_),b("update:modelValue",((m=p.value[$.value])==null?void 0:m.id)??void 0),b("group-change",((C=p.value[$.value])==null?void 0:C.id)??void 0)}function c(){te.prompt(d.newGroupPrompt,d.newGroup,{confirmButtonText:d.confirm,cancelButtonText:d.cancel}).then(({value:_})=>{_&&Et(_).then(()=>b("refresh"))})}function E(_){const m=p.value[_];!m||!m.id||te.prompt(d.renamePrompt,d.renameGroup,{confirmButtonText:d.confirm,cancelButtonText:d.cancel,inputValue:m.name}).then(({value:C})=>{C&&Dt(m.id,C).then(()=>b("refresh"))})}function D(_){const m=p.value[_];!m||!m.id||te.confirm(d.deleteConfirm,d.deleteTitle,{confirmButtonText:d.confirm,cancelButtonText:d.cancel,type:"warning"}).then(()=>{Ut(m.id).then(()=>b("refresh"))})}return(_,m)=>{const C=k("el-button"),O=k("el-icon"),G=k("el-dropdown-item"),l=k("el-dropdown-menu"),u=k("el-dropdown"),M=k("el-menu-item"),U=k("el-menu");return g(),V("div",{class:ne(["group-sidebar",{horizontal:x.horizontal}])},[v("div",At,[v("span",Nt,s(t(d).groupTitle),1),r(C,{size:"small",type:"primary",icon:t(Ne),circle:"",onClick:c,class:"add-btn"},null,8,["icon"])]),r(U,{"default-active":String($.value),class:"sidebar-menu",mode:x.horizontal?"horizontal":"vertical",onSelect:y},{default:o(()=>[(g(!0),V(j,null,Q(p.value,(T,L)=>(g(),z(M,{key:T.id??T.name,index:String(L),class:ne(["group-menu-item",{selected:$.value===L}])},{default:o(()=>[v("div",Rt,[r(O,{class:"group-icon"},{default:o(()=>[r(t(Re))]),_:1}),v("span",Ot,s(T.id==null?L===0?t(d).all:t(d).ungrouped:T.name),1),m[2]||(m[2]=v("span",{class:"flex-spacer"},null,-1)),T.id&&T.id!=="__trash__"&&$.value===L?(g(),z(u,{key:0,trigger:"click","hide-on-click":!1},{dropdown:o(()=>[r(l,null,{default:o(()=>[r(G,{onClick:N(B=>E(L),["stop"])},{default:o(()=>[w(s(t(d).rename),1)]),_:2},1032,["onClick"]),r(G,{onClick:N(B=>D(L),["stop"])},{default:o(()=>[w(s(t(d).delete),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[v("span",{class:"more-btn",onClick:m[0]||(m[0]=N(()=>{},["stop"]))},m[1]||(m[1]=[v("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none"},[v("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),v("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),v("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})],-1)]))]),_:2},1024)):F("",!0)])]),_:2},1032,["index","class"]))),128))]),_:1},8,["default-active","mode"])],2)}}}),he=re(Lt,[["__scopeId","data-v-ea0238b0"]]),Ft={class:"mobile-group-bar"},Zt={class:"mobile-snapshot-bar"},Ht={class:"content-scroll"},Wt=se({__name:"MainPage",setup(h){const e=ie("i18n",{}).sidebar||{},d=P([]),x=Z(()=>{const D=d.value.filter(_=>_.id!=null);return[{id:null,name:e.ungrouped||"未分组"},...D]}),p=P(0),$=P(void 0);function b(){Bt().then(D=>{d.value=[{id:null,name:e.all||"全部",icon:Le},...D||[]],(p.value==null||p.value>=d.value.length)&&(p.value=0)})}const y=P(!1),c=Z(()=>y.value?"width: 100vw; min-width: 0; max-width: 100vw;":"width: clamp(160px, 22vw, 240px); min-width: 120px; max-width: 320px;");function E(){y.value=window.innerWidth<=768}return ye(()=>{E(),window.addEventListener("resize",E),b()}),(D,_)=>{const m=k("el-aside"),C=k("el-main"),O=k("el-container");return g(),z(O,{class:ne(["main-container",{"is-mobile":y.value}])},{default:o(()=>[y.value?(g(),V(j,{key:0},[v("div",Ft,[r(he,{modelValue:$.value,"onUpdate:modelValue":_[0]||(_[0]=G=>$.value=G),groups:d.value,onGroupChange:_[1]||(_[1]=G=>$.value=G),onRefresh:b,horizontal:!0},null,8,["modelValue","groups"])]),v("div",Zt,[r(fe,{"group-id":$.value??void 0,"group-options":x.value},null,8,["group-id","group-options"])])],64)):(g(),V(j,{key:1},[r(m,{class:ne(["sidebar",{"sidebar-mobile":y.value}]),style:Oe(c.value)},{default:o(()=>[r(he,{modelValue:$.value,"onUpdate:modelValue":_[2]||(_[2]=G=>$.value=G),groups:d.value,onGroupChange:_[3]||(_[3]=G=>$.value=G),onRefresh:b,horizontal:y.value},null,8,["modelValue","groups","horizontal"])]),_:1},8,["class","style"]),r(C,{class:"content"},{default:o(()=>[v("div",Ht,[r(fe,{"group-id":$.value??void 0,"group-options":x.value},null,8,["group-id","group-options"])])]),_:1})],64))]),_:1},8,["class"])}}}),qt=re(Wt,[["__scopeId","data-v-2d93bb42"]]);export{qt as default};
